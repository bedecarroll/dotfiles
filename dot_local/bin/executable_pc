#!/usr/bin/env bash
set -euo pipefail

# Get all changes between @ and trunk()
mapfile -t files < <(
  jj diff -r '(latest(children(fork_point(@ | trunk())) & first_ancestors(@)))::@' --name-only
)

# Skip if no files
((${#files[@]} == 0)) && exit 0

GITHUB_TOKEN=$(gh auth token) pre-commit run --files "${files[@]}"
